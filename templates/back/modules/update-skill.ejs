<%
    if (typeof skill === 'undefined') locals.skill = false;

    let form;
    if (locals.skill) {
        form = "<form id='update-skill' method='POST' action='../../api/skill/update' data-update='true'>";
    } else {
        form = "<form id='update-skill' method='POST' action='../api/skill/create'>";
   }

    let skillData = {
        name: {
            fr: locals.skill ? locales[0][skill.slug_underscore + '_skill_name'] : "",
            en: locals.skill ? locales[1][skill.slug_underscore + '_skill_name'] : ""
        },
        description: {
            main: {
                fr: locals.skill ? locales[0][skill.slug_underscore + '_skill_name'] : "",
                en: locals.skill ? locales[1][skill.slug_underscore + '_skill_name'] : ""
            },
            levels: () => {
                for (let i = 1, count = 5; i <= count; i++) {
                    let frDescription = locals.skill ? locales[0][cosmo.slug_underscore + '_skill_description_' + i] : "",
                        enDescription = locals.skill ? locales[1][cosmo.slug_underscore + '_skill_description_' + i] : "";
                    %>
                        <div class="col-6 mb-4">
                            <label for="level-<%= i %>-description-fr">Description compétence niveau <%= i %> (FR)</label>
                            <textarea id="level-<%= i %>-description-fr" name="level-<%= i %>-description-fr" class="form-control" minlength="10"><%= frDescription %></textarea>
                        </div>
                        <div class="col-6">
                            <label for="level-<%= i %>-description-en">Description compétence niveau <%= i %> (EN)</label>
                            <textarea id="level-<%= i %>-description-en" name="level-<%= i %>-description-en" class="form-control" minlength="10"><%= enDescription %></textarea>
                        </div>
                    <%
                }
            }
        },
        image: locals.skill ? cloudinary.url("skills/" + skill.slug + ".png", {fetch_format: "auto", quality: "auto", secure: true}) : cloudinary.url("skills/default.png", { fetch_format: "auto", quality: "auto", secure: true }),
        saint_link: locals.skill ? skill.saint_link : "",
        cost: locals.skill ? skill.cost : "",
        awakened_skill: {
            index: locals.skill ? skill.awakened_skill.index : "",
            skill_link: locals.skill ? skill.awakened_skill.skill_link : ""
        }
    };
%>

<%- form %>
    <div class="row mb-5">
        <div class="col-12">
            <h1 class="text-white h4">
                <i class="material-icons"><%= data.icon %></i>
                <span class="ml-2"><%= data.head.title %></span>
            </h1>
        </div>
    </div>

    <div class="form-group row mb-4">
        <div class="col-6">
            <div class="row">
                <div class="col-6">
                    <label for="fr-name">Name (FR)</label>
                    <input type="text" id="fr-name" name="fr-name" placeholder="Ex: Athéna Exclamation" class="form-control" minlength="3" value="<%= skillData.name.fr %>" />
                </div>
                <div class="col-6">
                    <label for="en-name">Name (EN) <span class="font-weight-bold text-error">*</span></label>
                    <input type="text" id="en-name" name="en-name" placeholder="Ex: Athena Exclamation" class="form-control" minlength="3" value="<%= skillData.name.en %>" required />
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-12 thumb-container">
                    <label for="custom-file" class="pointer">Upload image <span class="small">(max 256kb)</span>: <span class="text-gold">default.png</span></label>
                    <input type="file" id="custom-file" class="not-visible" accept=".jpg, .jpeg, .png">
                    <img src="<%= skillData.image %>" id="avatar" class="img-fluid img big object-fit-contain rounded pointer" alt="Avatar" />
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-6">
            <label for="fr-description">Description principale (FR)</label>
            <textarea id="fr-description" name="fr-description" class="form-control main-description" minlength="10"><%= skillData.description.main.fr %></textarea>
        </div>
        <div class="col-6">
            <label for="en-description">Description principale (EN)</label>
            <textarea id="en-description" name="en-description" class="form-control main-description" minlength="10"><%= skillData.description.main.en %></textarea>
        </div>
    </div>

    <div class="row mb-4">
        <%= skillData.description.levels() %>
    </div>

    <div class="row mb-4">
        <div class="col-6">
            <label for="skill-cost">Coût de la compétence</label>
            <input type="number" id="skill-cost" name="skill-cost" placeholder="Ex: 2" class="form-control" value="<%= skillData.cost %>" />
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-8">
                    <label for="saint-link">Saint correspondant</label>
                    <input type="text" id="saint-link" name="saint-link" placeholder="Ex: Arayshiki Shaka" class="form-control" />
                </div>
                <div class="col-4 thumb-container">
                    <img class="not-input-file" src="<%= cloudinary.url("saints/default.png", {fetch_format: "auto", quality: "auto", secure: true}) %>" alt="Saint image" />
                </div>
            </div>
        </div>
    </div>

    <div class="e-s-5"></div>

    <div class="row mb-4">
        <div class="col-6">
            <label for="awakening-skill-index">Index de la compétence éveillée</label>
            <input type="number" id="awakening-skill-index" name="awakening-skill-index" placeholder="Ex: 4" min="1" max="4" class="form-control" value="<%= skillData.saint_link %>" />
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-8">
                    <label for="awakening-skill-link">Compétence éveillée correspondante</label>
                    <input type="text" id="awakening-skill-link" name="awakening-skill-link" placeholder="Ex: Greatest Caution" class="form-control" value="<%= skillData.awakened_skill.skill_link %>" />
                </div>
                <div class="col-4 thumb-container">
                    <img class="not-input-file" src="<%= cloudinary.url("skills/default.png", {fetch_format: "auto", quality: "auto", secure: true}) %>" alt="Awakening skill image" />
                </div>
            </div>
        </div>
    </div>

    <div class="form-group row mt-5 mb-4">
        <div class="col-12 mx-auto text-center">
            <button id="submit" type="submit" class="btn btn-lg custom-theme theme-2">Sauvegarder les modifications</button>
        </div>
    </div>
</form>
